sudo: required
language: ruby
services:
- docker
env:
  global:
  - IMAGE_NAME=ringcentral/chrome-vnc
  - secure: dUIsNqeu3Rzs7fVN1MsZ3JB5CaZr+l2X6nlr2DexVQrBelxgBoXZfzagtbPLJhvB2fjOLIITHsbpeshsQoBX6Rgrbu8PgPfnb8ZtQgYKnPE6C9ynCbndoro6vO+W6/9tCJhak57HugyrGFe5E3yTYSFtHamafuKPX3eDzNQmZPFE4XMJG2p5tRWD6rPn3gKDH5qaxgMIa24QTfL5paNZhdcgmvlgHedYThwZ2zsndxjPefPesLLxxLsuaRyl0R1lLuCVgS045OxBEKgNPLBk3Uhou+E218DPds/VTCfg+/Y3iIQ4e6y6EIUdy+3TfJSELJbSi0qmoLENsfcOeGOO9rd2ZljoLKa+DDqF2jM5Z+JBvnEb9FqvSgLXFNI7Pyal3PiWK6IYiMXWfIKwbmrV+GJAA13s90l3LOmLNPjybKGqKPjqRbQoGSCREHZpg7KKAugZNqx3GNlQLQB1sefbxAVa9uRywiYXaX4QYjUDmsyp6PUZvd0TrNfeqT6s5PnXGPr8t+n+5J3hsQwuTf/gDhgqAI0KyumY2+ubKJGmoC2rJgELK4V88OJdGyLR8hwEUtOc7PGGGGqYTf3lnRK4nEnfhao/VYs0Zu5Bn5VCalXgeErGacOOdVNkefKt0g3+wxfHnQChepkJoQEMSSokIh0zai1BtY/aRRXgVmwHuTg=
  - secure: hdRDUtzfDqysMmHl0ri+diUKe4abQe/a+pxrN/RD8AFyqYbtkNUASDc3V91peJSSrKTFlk+znRak5b+WJT7rZlX6aCc+0z9tGYAmPYSfP+ej6g230xxSsN1GktZ9P8WUDtvpd2X1GRvLOGFxW/rlIJIAiDnI7kCSKpZLzoAF3KXmuneyQ8nm497eUZ5NP8iCydgIzV53wqljWSTcV8c5dX3PM9Ca3OU1imjpHrmXPZcZU20Xj0Rw46kcbjboPQpcR3QPnUIRjC4c90dJAOM6TK/GXDkHHeNvF5PDSQE4GwoCmu0l/1Ebs4JG3BpSfeytGMUlyQlypcq2JKvbLmsaHDmu6fU0b90GD8ir/5F16zWtatsPPcZh+FwvZSpK53qciOs3V6i/0X5bDHSYeuWsZRPEPstrRGSW1+UMCQ7Nv7v1XNZptFsfRZThXnYjNNS+OAMjWTkCiNXinaGv9cT52nJz/ZsDZcUfFt9CmoOhuzFJxk+0lGAqRcQcs6PsU7ZpnXUwqjBAlbtRbrI5ZIas3rMGV9QNy7t4fWwX1NpouIUz/syDsje7ZmRDQz2udUPmCH0bX9d0a0q7yIbpzCAxGQvLamd58gWEPJQE6x/rrOQBCfkIpL4yoFwqAoxrm9++8Fq8X1AhcA19x8zNZxJu90sJu3yz5Zl+gn/eNsvF438=
before_script:
- cd dockerhub-CI/base-vnc-browser
- version="$(awk -F '[=.]'  '/ARG CHROME_VERSION/ {print $2}' Dockerfile.vnc.chrome)"
script:
- docker build -t "$IMAGE_NAME" -f "Dockerfile.vnc.chrome" .
after_script:
- docker images
before_deploy:
- docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"
- docker tag "$IMAGE_NAME" "${IMAGE_NAME}:latest"
- docker tag "$IMAGE_NAME" "${IMAGE_NAME}:${version}"
deploy:
  provider: script
  script: docker push "${IMAGE_NAME}:latest" && docker push "${IMAGE_NAME}:${version}"
  on:
    branch: master